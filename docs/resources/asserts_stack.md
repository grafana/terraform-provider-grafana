---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "grafana_asserts_stack Resource - terraform-provider-grafana"
subcategory: "Knowledge Graph"
description: |-
  Manages the Asserts Stack V2 configuration.
  This resource configures the Asserts stack with the required API tokens for integration
  with Grafana Cloud services. It uses the V2 stack endpoint for create/update operations.
  The cloud_access_policy_token is used internally for GCom API access, Mimir metrics
  authentication, and assertion detector webhook authentication. Create a Cloud Access Policy
  with the following scopes: stacks:read, metrics:read, metrics:write.
  The optional grafana_token is a Grafana Service Account token required when
  Grafana Managed Alerts is enabled for your stack.
---

# grafana_asserts_stack (Resource)

Manages the Asserts Stack V2 configuration.

This resource configures the Asserts stack with the required API tokens for integration
with Grafana Cloud services. It uses the V2 stack endpoint for create/update operations.

The `cloud_access_policy_token` is used internally for GCom API access, Mimir metrics 
authentication, and assertion detector webhook authentication. Create a Cloud Access Policy 
with the following scopes: `stacks:read`, `metrics:read`, `metrics:write`.

The optional `grafana_token` is a Grafana Service Account token required when 
Grafana Managed Alerts is enabled for your stack.

## Example Usage

```terraform
# Example: Asserts Stack with Cloud Access Policy Token
#
# This example shows how to configure the Asserts stack using existing
# Terraform resources to create the required tokens.

# Step 1: Create a Cloud Access Policy with required scopes
resource "grafana_cloud_access_policy" "asserts" {
  name         = "asserts-stack-policy"
  display_name = "Asserts Stack Policy"

  scopes = [
    "stacks:read",   # For GCom API access
    "metrics:read",  # For Mimir metrics access
    "metrics:write", # For Mimir metrics access
  ]

  realm {
    type       = "stack"
    identifier = var.stack_id
  }
}

# Step 2: Create a token from the Cloud Access Policy
resource "grafana_cloud_access_policy_token" "asserts" {
  name             = "asserts-stack-token"
  access_policy_id = grafana_cloud_access_policy.asserts.policy_id
}

# Step 3: Create a Grafana Service Account for dashboards and Grafana Managed Alerts
# Required permissions: dashboards:create/write/read, folders:create/write/read/delete,
# datasources:read/query, alert.provisioning:write, alert.notifications.provisioning:write,
# alert.notifications:write, alert.rules:read/create/delete
resource "grafana_cloud_stack_service_account" "asserts" {
  stack_slug  = var.stack_slug
  name        = "asserts-managed-alerts-sa"
  role        = "Admin"
  is_disabled = false
}

resource "grafana_cloud_stack_service_account_token" "asserts" {
  stack_slug         = var.stack_slug
  service_account_id = grafana_cloud_stack_service_account.asserts.id
  name               = "asserts-managed-alerts-token"
}

# Step 4: Configure the Asserts Stack
resource "grafana_asserts_stack" "main" {
  # Required: Cloud Access Policy token for GCom, Mimir, and assertion detector
  cloud_access_policy_token = grafana_cloud_access_policy_token.asserts.token

  # Grafana Service Account token for dashboards and Grafana Managed Alerts
  grafana_token = grafana_cloud_stack_service_account_token.asserts.key
}

# Variables
variable "stack_id" {
  description = "The Grafana Cloud stack ID"
  type        = string
}

variable "stack_slug" {
  description = "The Grafana Cloud stack slug"
  type        = string
}

# Outputs
output "stack_enabled" {
  value       = grafana_asserts_stack.main.enabled
  description = "Whether the Asserts stack is enabled"
}

output "stack_status" {
  value       = grafana_asserts_stack.main.status
  description = "Current onboarding status of the stack"
}

output "stack_version" {
  value       = grafana_asserts_stack.main.version
  description = "Configuration version number"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cloud_access_policy_token` (String, Sensitive) A Grafana Cloud Access Policy token with the following scopes: `stacks:read`, `metrics:read`, `metrics:write`. This token is used for GCom API access, Mimir authentication, and assertion detector webhook authentication.

### Optional

- `grafana_token` (String, Sensitive) A Grafana Service Account token for installing dashboards and Grafana Managed Alerts. Required permissions: `dashboards:create`, `dashboards:write`, `dashboards:read`, `folders:create`, `folders:write`, `folders:read`, `folders:delete`, `datasources:read`, `datasources:query`, `alert.provisioning:write`, `alert.notifications.provisioning:write`, `alert.notifications:write`, `alert.rules:read`, `alert.rules:create`, `alert.rules:delete`. Create using `grafana_cloud_stack_service_account_token` resource.
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))

### Read-Only

- `enabled` (Boolean) Whether the stack is currently enabled.
- `id` (String) The ID of this resource.
- `status` (String) Current onboarding status of the stack.
- `version` (Number) Configuration version number.

<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `read` (String)
- `update` (String)

## Import

Import is supported using the following syntax:

```shell
terraform import grafana_asserts_stack.name "{{ id }}"
```
